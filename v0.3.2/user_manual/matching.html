

<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>Specifying Matchers and Performing Matching &#8212; py_entitymatching 0.3.2 documentation</title>
    <link rel="stylesheet" href="../_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Selecting a ML-Matcher" href="select_best_matcher.html" />
    <link rel="prev" title="Imputing Missing Values" href="imputing_missing_values.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="select_best_matcher.html" title="Selecting a ML-Matcher"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="imputing_missing_values.html" title="Imputing Missing Values"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">py_entitymatching 0.3.2 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="steps_supp_em_workflows.html" accesskey="U">Steps of Supported EM Workflows</a> &#187;</li> 
      </ul>
    </div>
<div class="content-wrapper">
    <div class="content">
        <div class="document">
            <div class="sphinxsidebar">
                <h3>Table Of Contents</h3>
                <p class="caption"><span class="caption-text">How To Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../how_to_guide.html">How to Guide To Do Entity Matching</a></li>
</ul>
<p class="caption"><span class="caption-text">User Manual</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="whatisnew.html">What is New?</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="overview.html">Overview of Supported EM Processes</a></li>
<li class="toctree-l1"><a class="reference internal" href="guides.html">Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="datastructures.html">Data Structures</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="steps_supp_em_workflows.html">Steps of Supported EM Workflows</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="read_csv_files.html">Reading the CSV Files from Disk</a></li>
<li class="toctree-l2"><a class="reference internal" href="down_sampling.html">Down Sampling</a></li>
<li class="toctree-l2"><a class="reference internal" href="profiling.html">Profiling Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="data_exploration.html">Data Exploration</a></li>
<li class="toctree-l2"><a class="reference internal" href="blocking.html">Specifying Blockers and Performing Blocking</a></li>
<li class="toctree-l2"><a class="reference internal" href="create_feats_for_blocking.html">Creating Features for Blocking</a></li>
<li class="toctree-l2"><a class="reference internal" href="debugging_blocking.html">Debugging Blocking</a></li>
<li class="toctree-l2"><a class="reference internal" href="sampling.html">Sampling</a></li>
<li class="toctree-l2"><a class="reference internal" href="labeling.html">Labeling</a></li>
<li class="toctree-l2"><a class="reference internal" href="split_train_test.html">Splitting Labeled Data into Training and Testing Sets</a></li>
<li class="toctree-l2"><a class="reference internal" href="create_feats_for_matching.html">Creating Features for Matching</a></li>
<li class="toctree-l2"><a class="reference internal" href="extract_feat_vecs.html">Extracting Feature Vectors</a></li>
<li class="toctree-l2"><a class="reference internal" href="imputing_missing_values.html">Imputing Missing Values</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Specifying Matchers and Performing Matching</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#ml-matchers">ML-Matchers</a></li>
<li class="toctree-l3"><a class="reference internal" href="#rule-based-matchers">Rule-Based Matchers</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="select_best_matcher.html">Selecting a ML-Matcher</a></li>
<li class="toctree-l2"><a class="reference internal" href="debugging_matcher.html">Debugging ML-Matchers</a></li>
<li class="toctree-l2"><a class="reference internal" href="matchercombiner.html">Combining Predictions from Multiple Matchers</a></li>
<li class="toctree-l2"><a class="reference internal" href="triggers.html">Using Triggers to Update Matching Results</a></li>
<li class="toctree-l2"><a class="reference internal" href="evaluate_matching.html">Evaluating the Matching Output</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="misc.html">Miscellaneous</a></li>
</ul>
<p class="caption"><span class="caption-text">API Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="api/overview.html">Overview of Command Organization</a></li>
<li class="toctree-l1"><a class="reference internal" href="api/actual_commands.html">Commands in py_entitymatching</a></li>
<li class="toctree-l1"><a class="reference internal" href="api/actual_commands.html#experimental-commands">Experimental Commands</a></li>
</ul>

                <h3 style="margin-top: 1.5em;">Search</h3>

                <form class="search" action="../search.html" method="get">
                    <input type="text" name="q" size="18"/>
                    <input type="submit" value="Go"/>
                    <input type="hidden" name="check_keywords" value="yes"/>
                    <input type="hidden" name="area" value="default"/>
                </form>
                <p class="searchtip" style="font-size: 90%">
                    Enter search terms or a module, class or function name.
                </p>

            </div>
             
            <div class="documentwrapper">
                <div class="bodywrapper">
                    <div class="body">
                        
  <div class="section" id="specifying-matchers-and-performing-matching">
<h1>Specifying Matchers and Performing Matching<a class="headerlink" href="#specifying-matchers-and-performing-matching" title="Permalink to this headline">¶</a></h1>
<div class="section" id="ml-matchers">
<h2>ML-Matchers<a class="headerlink" href="#ml-matchers" title="Permalink to this headline">¶</a></h2>
<p>Once yor convert the labeled sample  into a table of feature vectors (and their
labels), the we can  can create and apply matchers to the feature vectors.
Currently py_entitymatching supports only ML-based matchers. Implementation wise,
a Matcher is defined as a Python class with certain methods (and some common
utility functions) and all concrete blockers inherit from this Matcher class and
override the methods. Specifically, each concrete matcher will implement at least
the following methods:</p>
<ul class="simple">
<li><p>fit (for training)</p></li>
<li><p>predict (for prediction)</p></li>
</ul>
<div class="section" id="creating-learning-based-matchers">
<h3>Creating Learning-Based Matchers<a class="headerlink" href="#creating-learning-based-matchers" title="Permalink to this headline">¶</a></h3>
<p>In py_entitymatching, there are seven concrete ML-matchers implemented: (1) naive bayes,
(2) logistic regression, (3) linear regression, (4) support vector machine, (5) decision
trees, (6) random forest, and (7) xgboost matcher.</p>
<p>These concrete matchers are just wrappers of scikit-learn matchers or that supports
scikit-learn wrappers (for eg., xgboost) and this is because
the fit/predict methods in scikit-learn are not metadata aware. The concrete matchers
make the scikit-learn matchers metadata aware.</p>
<p>Each matcher can be created by calling its constructor. Since these matchers are
just the wrappers of scikit-learn matchers, the parameters that can be given to
scikit-learn matchers can be to given to the matchers in py_entitymatching.
For example, a user can create a Decision Tree matcher like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">dt</span> <span class="o">=</span> <span class="n">em</span><span class="o">.</span><span class="n">DTMatcher</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
<p>Please refer to <a class="reference internal" href="api/supported_matchers.html#py_entitymatching.DTMatcher" title="py_entitymatching.DTMatcher"><code class="xref py py-meth docutils literal notranslate"><span class="pre">DTMatcher()</span></code></a>, <a class="reference internal" href="api/supported_matchers.html#py_entitymatching.RFMatcher" title="py_entitymatching.RFMatcher"><code class="xref py py-meth docutils literal notranslate"><span class="pre">RFMatcher()</span></code></a>,
<a class="reference internal" href="api/supported_matchers.html#py_entitymatching.NBMatcher" title="py_entitymatching.NBMatcher"><code class="xref py py-meth docutils literal notranslate"><span class="pre">NBMatcher()</span></code></a>, <code class="xref py py-meth docutils literal notranslate"><span class="pre">LogisticRegressionMatcher()</span></code>,
<code class="xref py py-meth docutils literal notranslate"><span class="pre">LinearRegressionMatcher()</span></code>, <a class="reference internal" href="api/supported_matchers.html#py_entitymatching.SVMMatcher" title="py_entitymatching.SVMMatcher"><code class="xref py py-meth docutils literal notranslate"><span class="pre">SVMMatcher()</span></code></a>, and
<a class="reference internal" href="api/supported_matchers.html#py_entitymatching.XGBoostMatcher" title="py_entitymatching.XGBoostMatcher"><code class="xref py py-meth docutils literal notranslate"><span class="pre">XGBoostMatcher()</span></code></a>
for more details.</p>
</div>
<div class="section" id="training-learning-based-matchers">
<h3>Training Learning-Based Matchers<a class="headerlink" href="#training-learning-based-matchers" title="Permalink to this headline">¶</a></h3>
<p>Once the ML-matcher is instantiated, you can train the matcher using the
<cite>fit</cite> command. An example of using the <cite>fit</cite> command for Decision Tree matcher
is shown below:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">dt</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">table</span><span class="o">=</span><span class="n">H</span><span class="p">,</span> <span class="n">exclude_attrs</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;_id&#39;</span><span class="p">,</span> <span class="s1">&#39;ltable_id&#39;</span><span class="p">,</span> <span class="s1">&#39;rtable_id&#39;</span><span class="p">],</span> <span class="n">target_attr</span><span class="o">=</span><span class="s1">&#39;gold_labels&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>There are other variants of <cite>fit</cite> method. As an example, Please refer to
<a class="reference internal" href="api/supported_matchers.html#py_entitymatching.DTMatcher.fit" title="py_entitymatching.DTMatcher.fit"><code class="xref py py-meth docutils literal notranslate"><span class="pre">fit()</span></code></a> for more details.</p>
</div>
<div class="section" id="applying-learning-based-matchers">
<h3>Applying Learning-Based Matchers<a class="headerlink" href="#applying-learning-based-matchers" title="Permalink to this headline">¶</a></h3>
<p>Once the ML-matcher is trained, you can predict the matches using the
<cite>predict</cite> command. An example of using the <cite>predict</cite> command for Decision Tree matcher
is shown below:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">dt</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">table</span><span class="o">=</span><span class="n">H</span><span class="p">,</span> <span class="n">exclude_attrs</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;_id&#39;</span><span class="p">,</span> <span class="s1">&#39;ltable_id&#39;</span><span class="p">,</span> <span class="s1">&#39;rtable_id&#39;</span><span class="p">],</span> <span class="n">target_attr</span><span class="o">=</span><span class="s1">&#39;predicted_labels&#39;</span><span class="p">,</span> <span class="n">return_probs</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">probs_attr</span><span class="o">=</span><span class="s1">&#39;proba&#39;</span><span class="p">,</span> <span class="n">append</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="go">inplace=True)</span>
</pre></div>
</div>
<p>There are other variants of <cite>predict</cite> method. As an example, Please refer to
<a class="reference internal" href="api/supported_matchers.html#py_entitymatching.DTMatcher.predict" title="py_entitymatching.DTMatcher.predict"><code class="xref py py-meth docutils literal notranslate"><span class="pre">predict()</span></code></a> for more details.</p>
</div>
</div>
<div class="section" id="rule-based-matchers">
<h2>Rule-Based Matchers<a class="headerlink" href="#rule-based-matchers" title="Permalink to this headline">¶</a></h2>
<p>You can write a few domain specific rules (for matching purposes) using the rule-based
matcher. If you want to write rules, then you must start by defining a set of features.
Each <cite>feature</cite> is a function that when applied to a tuple pair will return a
numeric value. We will discuss how to create a set of features in the section
<span class="xref std std-ref">label-create-features-matching</span>.</p>
<p>Once the features are created, py_entitymatching stores this set of features in a
feature table. We refer to this feature table as <cite>match_f</cite>. Then you will be able
to instantiate a rule-based matcher and add rules.</p>
<div class="section" id="adding-and-deleting-rules">
<h3>Adding and Deleting Rules<a class="headerlink" href="#adding-and-deleting-rules" title="Permalink to this headline">¶</a></h3>
<p>Once you have created the features for matching, you can create rules like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">brm</span> <span class="o">=</span> <span class="n">em</span><span class="o">.</span><span class="n">BooleanRuleMatcher</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">brm</span><span class="o">.</span><span class="n">add_rule</span><span class="p">(</span><span class="n">rule1</span><span class="p">,</span> <span class="n">match_f</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">brm</span><span class="o">.</span><span class="n">add_rule</span><span class="p">(</span><span class="n">rule2</span><span class="p">,</span> <span class="n">match_f</span><span class="p">)</span>
</pre></div>
</div>
<p>In the above, <cite>match_f</cite> is a set of features stored as a Dataframe (see section
<span class="xref std std-ref">label-create-features-matching</span>).</p>
<p>Each rule is a list of strings. Each string specifies a conjunction of predicates. Each
predicate has three parts: (1) an expression, (2) a comparison operator, and (3) a
value. The expression is evaluated over a tuple pair, producing a numeric value.
Currently, in py_entitymatching an expression is limited to contain a single feature
(being applied to a tuple pair). So an example predicate will look like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">name_name_lev</span><span class="p">(</span><span class="n">ltuple</span><span class="p">,</span> <span class="n">rtuple</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3</span>
</pre></div>
</div>
<p>In the above <cite>name_name_lev</cite> is feature. Concretely, this feature computes
Levenshtein distance between the <cite>name</cite> values in the input tuple pair.</p>
<p>As an example, the rules <cite>rule1</cite> and <cite>rule2</cite> can look like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">rule1</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;name_name_lev(ltuple, rtuple) &gt; 3&#39;</span><span class="p">,</span> <span class="s1">&#39;age_age_exact_match(ltuple, rtuple) !=0&#39;</span><span class="p">]</span>
<span class="n">rule2</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;address_address_lev(ltuple, rtuple) &gt; 6&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>In the above, <cite>rule1</cite> contains two predicates and <cite>rule2</cite> contains just a single
predicate. Each rule is a conjunction of predicates. That is, each rule will return True
only if all the predicates return True. The matcher is then a disjunction of rules.
That is, even if one of the rules return True, then the tuple pair will be a match.</p>
<p>Rules can also be deleted once they have been added to the matcher:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">rule_name</span> <span class="o">=</span> <span class="n">brm</span><span class="o">.</span><span class="n">add_rule</span><span class="p">(</span><span class="n">rule_1</span><span class="p">,</span> <span class="n">match_f</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">brm</span><span class="o">.</span><span class="n">delete_rule</span><span class="p">(</span><span class="n">rule_name</span><span class="p">)</span>
</pre></div>
</div>
<p>The command delete_rule must be given the name of the rule to be deleted. Rule names
and information on rules in a matcher can be found using the following commands:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># get a list of rule names</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">rule_names</span> <span class="o">=</span> <span class="n">brm</span><span class="o">.</span><span class="n">get_rule_names</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># view rule source</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">brm</span><span class="o">.</span><span class="n">view_rule</span><span class="p">(</span><span class="s1">&#39;rule_name&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># get rule fn</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">brm</span><span class="o">.</span><span class="n">get_rule</span><span class="p">(</span><span class="s1">&#39;rule_name&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="applying-rule-based-matcher">
<h3>Applying Rule-Based Matcher<a class="headerlink" href="#applying-rule-based-matcher" title="Permalink to this headline">¶</a></h3>
<p>Once the rules are specified, you can predict the matches using the
<cite>predict</cite> command. An example of using the <cite>predict</cite> command is shown below:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">brm</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">table</span><span class="o">=</span><span class="n">H</span><span class="p">,</span> <span class="n">target_attr</span><span class="o">=</span><span class="s1">&#39;predicted_labels&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>For more information on the <cite>predict</cite> method, please refer to
<code class="xref py py-meth docutils literal notranslate"><span class="pre">predict()</span></code> for more details.</p>
</div>
</div>
</div>


                    </div>
                </div>
            </div>

            
            <div class="clearer"></div>
        </div>
    </div>
</div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="select_best_matcher.html" title="Selecting a ML-Matcher"
             >next</a> |</li>
        <li class="right" >
          <a href="imputing_missing_values.html" title="Imputing Missing Values"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">py_entitymatching 0.3.2 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="steps_supp_em_workflows.html" >Steps of Supported EM Workflows</a> &#187;</li> 
      </ul>
    </div>
<style type="text/css">
    .scrollToTop {
        text-align: center;
        font-weight: bold;
        position: fixed;
        bottom: 60px;
        right: 40px;
        display: none;
    }
</style>
<a href="#" class="scrollToTop">Scroll To Top</a>
<script type="text/javascript">
$(document).ready(function() {
    //Check to see if the window is top if not then display button
    $(window).scroll(function() {
        if ($(this).scrollTop() > 200) {
            $('.scrollToTop').fadeIn();
        } else {
            $('.scrollToTop').fadeOut();
        }
    });

    //Click event to scroll to top
    $('.scrollToTop').click(function() {
        $('html, body').animate({
            scrollTop: 0
        }, 500);
        return false;
    });
});
</script>
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-27880019-2']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>

  </body>
</html>